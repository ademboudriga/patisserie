<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Modifier le Profil - P√¢tisserie </title>

  <!-- TailwindCSS -->
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <style>
    body { background-color: #f9fafb; }
    .sidebar { background: linear-gradient(to bottom right, #ec4899, #f43f5e); }
    .sidebar a:hover { background-color: rgba(255,255,255,0.1); }

    .toast {
      position: fixed;
      top: 20px; right: 20px;
      padding: 1rem 1.5rem;
      border-radius: 0.5rem;
      color: white;
      font-weight: 500;
      z-index: 1000;
      transform: translateX(100%);
      transition: transform 0.3s ease;
    }
    .toast.show { transform: translateX(0); }
    .toast.success { background-color: #10b981; }
    .toast.error { background-color: #ef4444; }
  </style>
</head>

<body class="flex h-screen">
  <!-- SIDEBAR -->
<aside class="sidebar w-64 p-6 text-white flex flex-col">
  <h2 class="text-2xl font-bold mb-8">üç∞ P√¢tisserie </h2>
  <nav class="flex-1 flex flex-col">
    <a href="dashboard.html" class="flex items-center gap-3 p-3 rounded-lg mb-2 hover:bg-white/10 transition-colors duration-200">
      <i class="fas fa-box"></i> Mati√®res Premi√®res
    </a>
            <a href="consommation.html" class="flex items-center gap-3 p-3 rounded-lg hover:bg-white/10"><i class="fas fa-chart-line"></i> Consommations</a>
    <a href="produit.html" class="flex items-center gap-3 p-3 rounded-lg mb-2 hover:bg-white/10 transition-colors duration-200">
      <i class="fas fa-birthday-cake"></i> Produits
    </a>
    <a href="vente.html" class="flex items-center gap-3 p-3 rounded-lg mb-2 hover:bg-white/10 transition-colors duration-200">
      <i class="fas fa-cash-register"></i> Ventes
    </a>
    <a href="commandes.html" class="flex items-center gap-3 p-3 rounded-lg mb-2 hover:bg-white/10 transition-colors duration-200">
      <i class="fas fa-receipt"></i> Commandes
    </a>
        <!-- ‚úÖ Nouveau lien : Factures -->
    <a href="facture.html" class="flex items-center gap-3 p-3 rounded-lg mb-2 hover:bg-white/10 transition">
      <i class="fas fa-file-invoice-dollar"></i> Factures
    </a>
    <a href="modifierProfile.html" class="flex items-center gap-3 p-3 rounded-lg mb-2 bg-white/10">
      <i class="fas fa-user-edit"></i>modifier profile 
    </a>
    <a href="index.html" class="flex items-center gap-3 p-3 rounded-lg mb-2 hover:bg-white/10 transition-colors duration-200">
      <i class="fas fa-sign-out-alt"></i> D√©connexion
    </a>
  </nav>
</aside>

  <!-- MAIN -->
  <main class="flex-1 p-8 overflow-auto">
    <div class="flex justify-between items-center mb-8">
      <h1 class="text-3xl font-bold text-gray-800">Modifier mon profil</h1>
    </div>

    <!-- FORMULAIRE -->
    <section class="bg-white p-6 rounded-xl shadow-lg max-w-xl mx-auto">
      <h2 class="text-xl font-semibold mb-4 text-gray-700 flex items-center">
        <i class="fas fa-user-cog text-pink-500 mr-2"></i> Mise √† jour des informations
      </h2>

      <form id="profileForm" class="flex flex-col gap-4">
        <div>
          <label for="username" class="block text-gray-700 mb-1">Nom d‚Äôutilisateur</label>
          <input type="text" id="username" placeholder="Nouveau nom d‚Äôutilisateur" class="border p-2 rounded-lg w-full" />
        </div>

        <div>
          <label for="password" class="block text-gray-700 mb-1">Nouveau mot de passe</label>
          <input type="password" id="password" placeholder="Nouveau mot de passe" class="border p-2 rounded-lg w-full" />
        </div>

        <button type="submit" class="bg-pink-500 hover:bg-pink-600 text-white px-4 py-2 rounded-lg font-medium flex items-center justify-center gap-2">
          <i class="fas fa-save"></i> Mettre √† jour
        </button>
      </form>
    </section>
  </main>

  <!-- TOAST -->
  <div id="toast" class="toast"></div>

  <!-- SCRIPT -->
<script>
  const API_URL = '/api/users/update';
  const form = document.getElementById('profileForm');
  const toast = document.getElementById('toast');

  function showToast(msg, type='success') {
    toast.textContent = msg;
    toast.className = `toast ${type} show`;
    setTimeout(() => toast.classList.remove('show'), 3000);
  }

  form.onsubmit = async e => {
    e.preventDefault();
    const username = document.getElementById('username').value.trim();
    const password = document.getElementById('password').value.trim();

    if (!username && !password) {
      return showToast('Veuillez entrer un nom d‚Äôutilisateur ou un mot de passe', 'error');
    }

    try {
      const res = await fetch(API_URL, {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ username, password }),
        credentials: 'include' // ‚Üê important pour envoyer le cookie de session
      });

      const data = await res.json();

      if (!res.ok) {
        // Affiche le message d'erreur du serveur
        return showToast(data.error || 'Erreur lors de la mise √† jour', 'error');
      }

      showToast(data.message || 'Profil mis √† jour ‚úÖ', 'success');
      form.reset();
    } catch (error) {
      console.error('Erreur fetch:', error);
      showToast('Erreur serveur', 'error');
    }
  };
</script>

</body>
</html>
